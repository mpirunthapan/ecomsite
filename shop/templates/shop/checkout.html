{% extends "shop/base.html" %}
{% block title %}Checkout{% endblock %}

{% block content %}
{% block navbar_cart %}
{% endblock %}


<div class="row mb-4">
    <div class="col-md-">
        <h4 class="mb-3 text-primary">Your Cart</h4>
        <table class="table table-bordered text-center align-middle">
            <thead class="table-light">
                <tr>
                    <th>#</th>
                    <th>Product</th>
                    <th>Qty</th>
                    <th>Price</th>
                    <th>Subtotal</th>
                </tr>
            </thead>
            <tbody id="item_list"></tbody>
            <tfoot>
                <tr class="table-light">
                    <td colspan="4" class="text-end fw-bold">Total</td>
                    <td class="fw-bold" id="totalPrice">$0</td>
                </tr>
            </tfoot>
        </table>


    </div>
</div>

<hr class="my-4">

<hr class="my-4">

<h4 class="mb-3">Billing Address</h4>

<div class="row">
    <div class="col-md-12">
        <form class="needs-validation" novalidate="" method="post">
            {% csrf_token %}
                <input type="hidden" name="items" id="items">
                <div class="row g-3">
                    <div class="col-sm-6">
                        <label for="firstName" class="form-label">First name</label>
                        <input name="firstName" type="text" class="form-control" id="firstName" placeholder="John" value="" required="">
                        <div class="invalid-feedback">
                        Valid first name is required.
                    </div>
                </div>

                <div class="col-sm-6">
                    <label for="lastName" class="form-label">Last name</label>
                    <input name="lastName" type="text" class="form-control" id="lastName" placeholder="Doe" value="" required="">
                    <div class="invalid-feedback">
                    Valid last name is required.
                    </div>
                </div>

                <div class="col-6">
                    <label for="email" class="form-label">Email</label>
                    <input id="email" name="email" type="email" class="form-control" placeholder="you@example.com" required="">
                    <div class="invalid-feedback">
                    Please enter a valid email address for shipping updates.
                    </div>
                </div>

                <div class="col-6">
                    <label for="phoneNumber" class="form-label">Mobile Number</label>
                    <input id="phoneNumber" name="phoneNumber" type="text" class="form-control" placeholder="0771122334" required="">
                    <div class="invalid-feedback">
                    Please enter a valid mobile number for shipping updates.
                    </div>
                </div>

                <div class="col-12">
                    <label for="address" class="form-label">Address</label>
                    <input id="address" name="address" type="text" class="form-control" placeholder="1234 Main St." required="">
                    <div class="invalid-feedback">
                    Please enter your shipping address.
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="state" class="form-label">State</label>
                    <input type="text" name="state" id="state" class="form-control" placeholder="" required="">
                    <div class="invalid-feedback">
                    Please provide a valid state.
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="city" class="form-label">City</label>
                    <input type="text" name="city" id="city" class="form-control" placeholder="" required="">
                    <div class="invalid-feedback">
                    Please provide a valid city.
                    </div>
                </div>

                <div class="col-md-3">
                    <label for="zip" class="form-label">Zip</label>
                    <input type="text" class="form-control" id="zip" name="zip" placeholder="" required="">
                    <div class="invalid-feedback">
                    Zip code required.
                    </div>
                </div>

                <div class="col-md-6">
                    <label for="total" class="form-label">Amount to paid</label>
                    <input readonly type="text" class="form-control" id="total" name="total">
                    <div>
                    </div>
                </div>
            </div>
            
            <hr class="my-4">

            <button class="w-100 btn btn-primary btn-lg" type="submit">Please Order</button>
        </form> 
    </div>
</div>

{% endblock %}

{% block js_script %}
<script type="text/javascript">
    if(localStorage.getItem('cart') == null){
        var cart = {};
    } else {
        cart = JSON.parse(localStorage.getItem('cart'));    
    }

    let itemIndex = 1;
    let total = 0;

    for(item in cart){
        let name = cart[item]['name'];
        let price = cart[item]['price'];
        let qty = cart[item]['qty'];
        total += (qty * price);

        itemString = `
            <tr>
                <td>${itemIndex}.</td>
                <td>${name}</td>
                <td>
                    <span class="badge bg-secondary">${qty}</span>
                </td>
                <td>
                    <span class="badge bg-warning">$${price}</span>
                </td>
                <td>
                    <span class="fw-bold">$${(qty * price).toFixed(2)}</span>
                </td>
            </tr>`;

            $('#item_list').append(itemString);
            itemIndex += 1;
    }

    $('#total').val(`$${total.toFixed(2)}`);

    $('#totalPrice').html(`$${total.toFixed(2)}`);

    $('#items').val(JSON.stringify(cart));
</script>
{% endblock  %}